# 🧪 온프레미스 qwen-code 테스트 가이드

## 📋 테스트 개요

온프레미스 환경에서 qwen-code가 올바르게 동작하는지 확인하기 위한 종합 테스트 가이드입니다.

### ✅ 완료된 구현 사항
- [x] **SSL 우회 기능**: `fetch.ts`에 3줄 추가
- [x] **내부 웹 검색**: `web-search.ts` 완전 대체
- [x] **설정 파일**: `internal-web-config.json` 생성
- [x] **문서화**: 완전한 사용자 가이드 제공

---

## 🔧 테스트 환경 설정

### 1. 환경변수 설정
```bash
# Linux/macOS
export OPENAI_BASE_URL="http://your-internal-llm:8080/v1"
export OPENAI_API_KEY="dummy-key-for-internal"
export ON_PREMISE_MODE="true"
export NODE_TLS_REJECT_UNAUTHORIZED="0"
export INTERNAL_WEB_CONFIG_PATH="./internal-web-config.json"

# Windows PowerShell
$env:OPENAI_BASE_URL="http://your-internal-llm:8080/v1"
$env:OPENAI_API_KEY="dummy-key-for-internal"
$env:ON_PREMISE_MODE="true"
$env:NODE_TLS_REJECT_UNAUTHORIZED="0"
$env:INTERNAL_WEB_CONFIG_PATH="./internal-web-config.json"
```

### 2. 설정 파일 위치 확인
```bash
# 설정 파일이 올바른 위치에 있는지 확인
ls -la internal-web-config.json
cat internal-web-config.json | head -20
```

---

## 🧪 단계별 테스트

### Phase 1: 기본 환경 테스트

#### 1.1 환경변수 확인
```bash
echo "OPENAI_BASE_URL: $OPENAI_BASE_URL"
echo "ON_PREMISE_MODE: $ON_PREMISE_MODE"
echo "NODE_TLS_REJECT_UNAUTHORIZED: $NODE_TLS_REJECT_UNAUTHORIZED"
echo "INTERNAL_WEB_CONFIG_PATH: $INTERNAL_WEB_CONFIG_PATH"
```

**기대 결과**: 모든 환경변수가 올바르게 설정되어 표시됨

#### 1.2 qwen 명령어 접근성 확인
```bash
# qwen 명령어가 설치되었는지 확인
which qwen
qwen --version
```

**기대 결과**: qwen 명령어 경로와 버전이 표시됨

#### 1.3 설정 파일 유효성 검사
```bash
# JSON 형식이 올바른지 확인
node -p "JSON.parse(require('fs').readFileSync('./internal-web-config.json', 'utf8'))"
```

**기대 결과**: JSON 파싱 오류 없이 설정 객체가 표시됨

### Phase 2: 내부 LLM 연동 테스트

#### 2.1 기본 채팅 테스트
```bash
# 간단한 인사 메시지
qwen "안녕하세요!"
```

**기대 결과**: 내부 LLM에서 정상적인 응답 반환

#### 2.2 한국어 처리 테스트
```bash
# 한국어 복잡한 질문
qwen "오늘 날씨가 어떤가요? 간단히 대답해주세요."
```

**기대 결과**: 한국어로 자연스러운 응답 생성

#### 2.3 연결 상태 확인
```bash
# 내부 LLM 서버 연결 테스트
curl -s "$OPENAI_BASE_URL/models" | head -100
```

**기대 결과**: 사용 가능한 모델 목록 반환

### Phase 3: SSL 우회 기능 테스트

#### 3.1 HTTPS 사이트 접근 테스트
```bash
# SSL 우회가 적용되는지 확인
NODE_TLS_REJECT_UNAUTHORIZED=0 node -e "
const https = require('https');
https.get('https://self-signed.badssl.com/', (res) => {
  console.log('SSL 우회 성공:', res.statusCode);
}).on('error', (err) => {
  console.log('SSL 오류:', err.message);
});
"
```

**기대 결과**: SSL 우회 성공 메시지 출력

#### 3.2 환경변수 조건부 테스트
```bash
# ON_PREMISE_MODE가 false일 때는 SSL 검증 유지되는지 확인
ON_PREMISE_MODE=false node -e "console.log('NODE_TLS_REJECT_UNAUTHORIZED:', process.env.NODE_TLS_REJECT_UNAUTHORIZED)"
```

**기대 결과**: SSL 검증이 유지됨

### Phase 4: 내부 웹 검색 기능 테스트

#### 4.1 설정 파일 로딩 테스트
```bash
# 내부 웹 검색 설정이 올바르게 로드되는지 확인
qwen "internal web search test"
```

**기대 결과**: 내부 웹 검색 시스템이 활성화되고 설정 파일을 로드함

#### 4.2 URL 매칭 알고리즘 테스트
```bash
# API 관련 키워드로 검색
qwen "API 문서에서 인증 방법 찾아줘"
```

**기대 결과**: 
- `api_docs` URL이 선택됨
- 해당 웹사이트에 접속 시도
- 인증 관련 내용 추출

#### 4.3 위키 검색 테스트
```bash
# 위키 관련 키워드로 검색
qwen "내부 위키에서 개발 가이드라인 찾아줘"
```

**기대 결과**:
- `company_wiki` URL이 선택됨
- 개발 가이드라인 관련 내용 추출

#### 4.4 다중 사이트 검색 테스트
```bash
# 여러 사이트에서 정보를 찾을 수 있는 쿼리
qwen "프로젝트 문서와 개발 가이드 정보 찾아줘"
```

**기대 결과**:
- 여러 내부 사이트에서 관련 정보 검색
- 결과를 종합하여 제공

### Phase 5: 고급 기능 테스트

#### 5.1 캐시 기능 테스트
```bash
# 같은 쿼리를 두 번 실행하여 캐시 동작 확인
qwen "API 문서 검색 테스트"
qwen "API 문서 검색 테스트"
```

**기대 결과**: 두 번째 실행이 첫 번째보다 빠름 (캐시 적용)

#### 5.2 에러 처리 테스트
```bash
# 존재하지 않는 내부 사이트에 대한 쿼리
qwen "존재하지않는사이트에서 정보 찾아줘"
```

**기대 결과**: 적절한 에러 메시지와 대안 제안

#### 5.3 긴 응답 처리 테스트
```bash
# 복잡한 기술 질문
qwen "마이크로서비스 아키텍처 설계 시 고려해야 할 보안 요소들을 내부 문서에서 찾아서 상세히 설명해줘"
```

**기대 결과**: 여러 내부 사이트에서 정보를 수집하여 종합적인 답변 제공

---

## 📊 성능 테스트

### 응답 시간 측정
```bash
#!/bin/bash
echo "=== qwen-code 성능 테스트 ==="

# 기본 채팅 응답 시간
echo "1. 기본 채팅 테스트..."
time qwen "안녕하세요"

# 웹 검색 응답 시간
echo "2. 웹 검색 테스트..."
time qwen "API 문서에서 인증 방법 찾아줘"

# 복잡한 질의 응답 시간
echo "3. 복잡한 질의 테스트..."
time qwen "내부 위키와 API 문서를 참고해서 OAuth 2.0 구현 방법 설명해줘"
```

### 메모리 사용량 모니터링
```bash
# qwen 실행 중 메모리 사용량 확인
ps aux | grep qwen
top -p $(pgrep qwen)
```

---

## 🔍 트러블슈팅 테스트

### 자주 발생할 수 있는 문제들

#### 1. 내부 LLM 서버 연결 실패
```bash
# 연결 테스트
curl -v "$OPENAI_BASE_URL/models"

# DNS 확인
nslookup your-internal-llm.company.com

# 포트 확인
telnet your-internal-llm.company.com 8080
```

#### 2. 설정 파일 문제
```bash
# JSON 구문 검증
python -m json.tool internal-web-config.json

# 파일 권한 확인
ls -la internal-web-config.json

# 파일 인코딩 확인
file internal-web-config.json
```

#### 3. 환경변수 문제
```bash
# 모든 qwen 관련 환경변수 확인
env | grep -E "(OPENAI|NODE_TLS|ON_PREMISE|INTERNAL)"

# 환경변수 재설정
source ~/.bashrc
```

#### 4. 네트워크 접근 문제
```bash
# 내부 웹사이트 접근성 확인
curl -I http://wiki.company.com
curl -I http://api-docs.internal.com
curl -I http://confluence.company.com
```

---

## ✅ 테스트 체크리스트

### 필수 기능 테스트
- [ ] **환경변수 설정**: 모든 필수 환경변수가 올바르게 설정됨
- [ ] **qwen 명령어**: 명령어가 정상적으로 실행됨
- [ ] **내부 LLM 연동**: 기본 채팅이 정상 동작
- [ ] **SSL 우회**: HTTPS 사이트 접근 시 인증서 오류 없음
- [ ] **설정 파일 로딩**: internal-web-config.json이 올바르게 로드됨
- [ ] **URL 매칭**: 검색 쿼리에 따른 적절한 URL 선택
- [ ] **웹 크롤링**: 내부 웹사이트에서 정보 추출
- [ ] **응답 생성**: 추출된 정보를 바탕으로 자연스러운 답변 생성

### 선택적 기능 테스트
- [ ] **캐시 기능**: 동일한 쿼리에 대한 빠른 응답
- [ ] **에러 처리**: 적절한 에러 메시지와 복구 방법 제시
- [ ] **다중 사이트 검색**: 여러 내부 사이트에서 정보 수집
- [ ] **성능 최적화**: 합리적인 응답 시간 (10초 이내)

### 사용자 경험 테스트
- [ ] **설치 용이성**: 문서대로 따라하면 쉽게 설치 가능
- [ ] **설정 간편성**: 환경변수 + JSON 파일만으로 설정 완료
- [ ] **사용법 일관성**: 기존 qwen 사용법과 100% 동일
- [ ] **응답 품질**: 유용하고 정확한 정보 제공

---

## 📝 테스트 결과 보고서 템플릿

```markdown
# qwen-code 온프레미스 테스트 결과

## 테스트 환경
- OS: [Windows/Linux/macOS]
- Node.js 버전: 
- qwen-code 버전:
- 내부 LLM 서버: 
- 테스트 일시: 

## 테스트 결과
### ✅ 성공한 테스트
1. 환경변수 설정: 성공
2. 기본 채팅: 성공 (응답시간: 2.3초)
3. SSL 우회: 성공
4. 내부 웹 검색: 성공 (3개 사이트에서 정보 추출)

### ❌ 실패한 테스트
1. [실패한 테스트가 있다면 기록]

### 📊 성능 지표
- 기본 채팅 응답시간: 평균 2.1초
- 웹 검색 응답시간: 평균 8.7초
- 메모리 사용량: 평균 125MB

### 🔧 발견된 문제점
1. [문제점이 있다면 기록]

### 💡 개선 제안
1. [개선 제안이 있다면 기록]

### 결론
[ ] 운영 환경 배포 준비 완료
[ ] 추가 테스트 필요
[ ] 문제 해결 후 재테스트 필요
```

---

## 🎯 최종 검증 시나리오

```bash
#!/bin/bash
echo "🚀 qwen-code 온프레미스 최종 검증 시나리오"
echo "============================================"

echo "📋 1단계: 환경 설정 확인"
echo "OPENAI_BASE_URL: $OPENAI_BASE_URL"
echo "ON_PREMISE_MODE: $ON_PREMISE_MODE"
echo "설정 파일 존재: $(test -f "$INTERNAL_WEB_CONFIG_PATH" && echo "✅" || echo "❌")"

echo ""
echo "💬 2단계: 기본 채팅 테스트"
qwen "안녕하세요! 잘 동작하나요?"

echo ""
echo "🔍 3단계: 내부 웹 검색 테스트"
qwen "API 문서에서 인증 방법 찾아줘"

echo ""
echo "🏗️ 4단계: 코드 생성 테스트" 
qwen "Python으로 REST API 클라이언트 코드 작성해줘"

echo ""
echo "✅ 모든 테스트 완료!"
echo "온프레미스 qwen-code가 성공적으로 구축되었습니다!"
```

**이 스크립트 실행 결과**: 모든 단계가 성공하면 온프레미스 환경에서 qwen-code 완전 동작 확인!

---

**테스트 가이드 버전**: v1.0  
**작성일**: 2025-01-26  
**검증 대상**: 온프레미스 qwen-code PoC  
**예상 테스트 시간**: 30-45분