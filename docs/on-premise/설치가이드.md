# 🚀 온프레미스 qwen-code 설치 가이드

## 📖 개요

이 가이드는 폐쇄망(온프레미스) 환경에서 qwen-code AI 코딩 어시스턴트를 설치하고 설정하는 방법을 안내합니다.

### ⭐ 핵심 특징
- **3개 파일만 수정**: 최소한의 변경으로 구현
- **간단한 설정**: 환경변수 + JSON 파일만으로 완료
- **기존 사용법 유지**: qwen 명령어 그대로 사용
- **내부 LLM 연동**: 외부 의존성 없이 내부 서버 활용

---

## 🎯 지원 환경

### 시스템 요구사항
- **운영체제**: Windows 10+, Linux, macOS
- **Node.js**: v20.0.0 이상
- **메모리**: 최소 4GB RAM
- **네트워크**: 내부 LLM 서버 접근 가능

### 내부 인프라 요구사항
- **내부 LLM 서버**: OpenAI API 호환 (예: OpenRouter 스타일)
- **내부 웹사이트**: 접근 가능한 문서 사이트 (위키, API 문서 등)
- **HTTP 통신**: SSL 인증서 없는 내부 통신 환경

---

## 📦 설치 과정

### 1단계: 기본 패키지 설치

#### 외부망에서 설치 (1회만)
```bash
# npm을 통한 설치
npm install -g @qwen-code/qwen-code

# 또는 yarn 사용
yarn global add @qwen-code/qwen-code
```

#### 오프라인 설치 (폐쇄망)
```bash
# 외부망에서 패키지 다운로드
npm pack @qwen-code/qwen-code

# 내부망으로 파일 이동 후 설치
npm install -g qwen-code-*.tgz
```

### 2단계: 설정 파일 준비

#### 내부 웹 URL 설정 파일 생성
```bash
# 홈 디렉토리에 설정 파일 생성
cd ~
nano internal-web-config.json
```

#### 설정 파일 내용 (`internal-web-config.json`)
```json
{
  "enabled": true,
  "timeout": 10000,
  "urls": {
    "company_wiki": {
      "url": "http://wiki.company.com",
      "description": "회사 내부 위키, 개발 가이드, API 문서, 기술 표준",
      "categories": ["documentation", "technical", "wiki"]
    },
    "api_docs": {
      "url": "http://api-docs.internal.com",
      "description": "내부 API 레퍼런스, REST API 문서, 인증 가이드",
      "categories": ["api", "reference", "documentation"]
    },
    "confluence": {
      "url": "http://confluence.company.com",
      "description": "프로젝트 문서, 요구사항, 회의록, 개발 프로세스",
      "categories": ["project", "requirements", "process"]
    },
    "jira": {
      "url": "http://jira.company.com",
      "description": "이슈 트래킹, 버그 리포트, 태스크 관리",
      "categories": ["issues", "bugs", "tasks"]
    },
    "jenkins": {
      "url": "http://jenkins.internal.com",
      "description": "CI/CD 파이프라인, 빌드 로그, 배포 상태",
      "categories": ["cicd", "build", "deployment"]
    }
  }
}
```

### 3단계: 환경변수 설정

#### Linux/macOS 환경
```bash
# ~/.bashrc 또는 ~/.zshrc에 추가
export OPENAI_BASE_URL="http://internal-llm.company.com:8080/v1"
export OPENAI_API_KEY="any-dummy-key-for-internal"
export ON_PREMISE_MODE="true"
export NODE_TLS_REJECT_UNAUTHORIZED="0"
export INTERNAL_WEB_CONFIG_PATH="$HOME/internal-web-config.json"

# 설정 적용
source ~/.bashrc
```

#### Windows 환경
```cmd
# PowerShell에서 실행
$env:OPENAI_BASE_URL="http://internal-llm.company.com:8080/v1"
$env:OPENAI_API_KEY="any-dummy-key-for-internal"
$env:ON_PREMISE_MODE="true"
$env:NODE_TLS_REJECT_UNAUTHORIZED="0"
$env:INTERNAL_WEB_CONFIG_PATH="C:\Users\%USERNAME%\internal-web-config.json"
```

#### Docker 환경 (선택사항)
```bash
# docker-compose.yml 파일 활용
version: '3.8'
services:
  qwen-code:
    image: node:20-alpine
    environment:
      - OPENAI_BASE_URL=http://internal-llm.company.com:8080/v1
      - OPENAI_API_KEY=any-dummy-key-for-internal
      - ON_PREMISE_MODE=true
      - NODE_TLS_REJECT_UNAUTHORIZED=0
      - INTERNAL_WEB_CONFIG_PATH=/app/internal-web-config.json
    volumes:
      - ./internal-web-config.json:/app/internal-web-config.json
```

---

## ✅ 설치 검증

### 기본 동작 확인
```bash
# 1. qwen 명령어 실행 가능 확인
qwen --version

# 2. 기본 채팅 테스트
qwen "Hello, 안녕하세요!"

# 3. 내부 LLM 연동 확인
qwen "현재 시간을 알려주세요"
```

### 웹 검색 기능 확인
```bash
# 내부 웹사이트 검색 테스트
qwen "API 문서에서 인증 방법 찾아줘"

# 위키 검색 테스트  
qwen "내부 위키에서 React 개발 가이드라인 찾아줘"

# 프로젝트 문서 검색 테스트
qwen "Confluence에서 최신 개발 프로세스 문서 찾아줘"
```

### 고급 기능 테스트
```bash
# 코드 생성 테스트
qwen "Python으로 REST API 클라이언트 코드 작성해줘"

# 파일 분석 테스트  
qwen "현재 디렉토리의 package.json 파일을 분석해줘"

# 디버깅 도움 테스트
qwen "이 JavaScript 에러를 해결하는 방법 알려줘: ReferenceError: fetch is not defined"
```

---

## 🔧 고급 설정

### 커스텀 설정 옵션

#### 웹 검색 타임아웃 조정
```json
{
  "enabled": true,
  "timeout": 15000,  // 15초로 연장
  "max_retries": 3,  // 재시도 횟수 설정
  "urls": { ... }
}
```

#### 프록시 서버 설정
```bash
# HTTP 프록시 사용 시
export HTTP_PROXY="http://proxy.company.com:8080"
export HTTPS_PROXY="http://proxy.company.com:8080"
```

#### 로그 레벨 설정
```bash
# 디버깅을 위한 상세 로그
export DEBUG="qwen:*"
export LOG_LEVEL="debug"
```

### 성능 최적화

#### 캐시 설정
```bash
# 웹 검색 결과 캐시 활성화
export ENABLE_WEB_CACHE="true"
export CACHE_TTL="3600"  # 1시간
```

#### 동시 요청 제한
```json
{
  "enabled": true,
  "concurrent_requests": 3,  // 동시 웹 요청 제한
  "rate_limit": {
    "requests_per_minute": 60  // 분당 요청 제한
  }
}
```

---

## 🔍 트러블슈팅

### 자주 발생하는 문제들

#### 1. 내부 LLM 서버 연결 실패
```bash
# 문제: Connection refused 에러
# 해결: 서버 URL과 포트 확인
curl http://internal-llm.company.com:8080/v1/models

# 정상 응답 예시:
# {"data": [{"id": "gpt-3.5-turbo", ...}]}
```

#### 2. SSL 인증서 오류
```bash
# 문제: SSL certificate problem
# 해결: SSL 우회 설정 확인
echo $NODE_TLS_REJECT_UNAUTHORIZED
# 출력: 0

# 또는 임시 해결
export NODE_TLS_REJECT_UNAUTHORIZED="0"
```

#### 3. 웹 검색 실패
```bash
# 문제: 내부 웹사이트 접근 불가
# 해결: URL 접근성 확인
curl -I http://wiki.company.com
# 응답: HTTP/1.1 200 OK

# 설정 파일 경로 확인
ls -la $INTERNAL_WEB_CONFIG_PATH
```

#### 4. 권한 문제
```bash
# 문제: Permission denied
# 해결: 파일 권한 확인 및 수정
chmod 644 ~/internal-web-config.json
chmod +x $(which qwen)
```

### 디버깅 방법

#### 상세 로그 활성화
```bash
# 모든 디버그 정보 출력
export DEBUG="*"
qwen "테스트 메시지"
```

#### 설정 확인 스크립트
```bash
#!/bin/bash
echo "=== qwen-code 온프레미스 설정 확인 ==="
echo "1. 환경변수 확인:"
echo "   OPENAI_BASE_URL: $OPENAI_BASE_URL"
echo "   ON_PREMISE_MODE: $ON_PREMISE_MODE"
echo "   NODE_TLS_REJECT_UNAUTHORIZED: $NODE_TLS_REJECT_UNAUTHORIZED"
echo ""
echo "2. 설정 파일 확인:"
echo "   경로: $INTERNAL_WEB_CONFIG_PATH"
echo "   파일 존재: $(test -f "$INTERNAL_WEB_CONFIG_PATH" && echo "✅" || echo "❌")"
echo ""
echo "3. 네트워크 확인:"
curl -s -o /dev/null -w "   LLM 서버: %{http_code}\\n" "$OPENAI_BASE_URL/models"
echo ""
echo "4. qwen 명령어 확인:"
which qwen && echo "   qwen 설치: ✅" || echo "   qwen 설치: ❌"
```

---

## 📚 사용법 예시

### 일반적인 사용 시나리오

#### 개발 문서 검색
```bash
# API 문서에서 특정 정보 찾기
qwen "API 문서에서 OAuth 인증 구현 방법 알려줘"

# 내부 위키에서 개발 가이드 찾기
qwen "위키에서 코딩 스타일 가이드 찾아줘"

# Confluence에서 프로젝트 정보 검색
qwen "Confluence에서 신규 프로젝트 온보딩 절차 찾아줘"
```

#### 코드 개발 지원
```bash
# 회사 표준에 맞는 코드 생성
qwen "내부 API 호출을 위한 JavaScript fetch 코드 작성해줘"

# 기존 코드 분석 및 개선
qwen "이 함수를 더 효율적으로 리팩토링해줘"

# 디버깅 도움
qwen "이 에러 로그를 분석하고 해결 방법 제시해줘"
```

#### 프로젝트 관리
```bash
# 이슈 관리
qwen "JIRA에서 현재 할당된 버그 이슈들 확인해줘"

# 빌드 상태 확인
qwen "Jenkins에서 최근 빌드 실패 원인 분석해줘"

# 배포 관련 정보
qwen "배포 가이드에서 프로덕션 배포 체크리스트 찾아줘"
```

### 고급 활용법

#### 멀티 소스 정보 조합
```bash
# 여러 내부 사이트에서 정보 수집
qwen "API 문서와 위키를 참고해서 새로운 마이크로서비스 개발 가이드 만들어줘"

# 프로젝트 전체 상황 파악
qwen "JIRA, Confluence, Jenkins를 종합해서 현재 프로젝트 상태 요약해줘"
```

#### 팀 온보딩 지원
```bash
# 신입 개발자 가이드
qwen "신입 개발자를 위한 개발 환경 설정 가이드 만들어줘"

# 프로젝트 이해
qwen "이 프로젝트의 아키텍처와 주요 구성요소 설명해줘"
```

---

## 🛠️ 유지보수

### 정기 업데이트

#### 설정 파일 업데이트
```bash
# 새로운 내부 웹사이트 추가
# internal-web-config.json 파일 수정 후 재시작 없이 적용
```

#### 패키지 업데이트
```bash
# 새 버전 확인
npm list -g @qwen-code/qwen-code

# 업데이트 (외부망에서)
npm update -g @qwen-code/qwen-code
```

### 백업 및 복구

#### 설정 백업
```bash
# 설정 파일 백업
cp ~/internal-web-config.json ~/internal-web-config.json.backup

# 환경변수 백업
env | grep -E "(OPENAI|ON_PREMISE|NODE_TLS)" > ~/qwen-env.backup
```

#### 설정 복구
```bash
# 설정 파일 복구
cp ~/internal-web-config.json.backup ~/internal-web-config.json

# 환경변수 복구
source ~/qwen-env.backup
```

---

## 📞 지원 및 도움말

### 추가 자료
- **상세 문서**: `docs/on-premise/온프레미스-qwen-code-PRD.md`
- **개발 계획**: `docs/on-premise/개발진행계획서.md`
- **기본 사용법**: `docs/` 폴더의 기존 문서들

### 자주 묻는 질문 (FAQ)

#### Q: 외부 인터넷 없이 완전히 동작하나요?
A: 네, 설치 후에는 완전히 내부망만으로 동작합니다. 설치는 외부망에서 1회만 진행하면 됩니다.

#### Q: 기존 qwen 사용법과 다른 점이 있나요?  
A: 전혀 없습니다. 환경변수 설정 후 동일한 `qwen` 명령어를 그대로 사용하시면 됩니다.

#### Q: 새로운 내부 웹사이트를 추가하려면?
A: `internal-web-config.json` 파일에 새 URL과 설명을 추가하시면 됩니다. 재시작은 필요하지 않습니다.

#### Q: 성능이 느려진다면?
A: 캐시 설정을 활성화하고, 타임아웃 값을 조정하세요. 대부분의 경우 크게 개선됩니다.

---

## 🎉 마무리

축하합니다! 온프레미스 환경에서 qwen-code AI 코딩 어시스턴트 설정이 완료되었습니다.

### 다음 단계
1. ✅ 기본 채팅으로 LLM 연동 확인  
2. ✅ 내부 웹 검색 기능 테스트
3. ✅ 실제 개발 업무에 활용
4. 📝 팀원들과 설정 공유
5. 📈 사용 패턴 분석 및 최적화

### 성공적인 활용을 위한 팁
- **점진적 도입**: 간단한 질문부터 시작해서 복잡한 업무로 확장
- **설정 최적화**: 자주 사용하는 웹사이트를 우선적으로 설정
- **팀 공유**: 유용한 사용 패턴을 팀원들과 공유
- **피드백 수집**: 개선점을 지속적으로 발굴하고 적용

---

**가이드 버전**: v1.0  
**최종 업데이트**: 2025-01-26  
**작성자**: Claude Code SuperClaude  
**지원**: 개발팀 내부 채널